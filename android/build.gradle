// Top-level build file where you can add configuration options common to all sub-projects/modules.

import org.jetbrains.kotlin.gradle.tasks.KotlinCompile

buildscript {
  ext {
    buildToolsVersion = "34.0.0"
    minSdkVersion = 23
    compileSdkVersion = 34
    targetSdkVersion = 34
    // Keep Kotlin aligned with the versions used by RN 0.72.x + AndroidX artifacts.
    // Mismatch here can surface as: "Module was compiled with an incompatible version of Kotlin".
    kotlinVersion = "1.8.0"
     ndkVersion = "28.2.13676358"
  }
  repositories {
    google()
    mavenCentral()
  }
  dependencies {
    classpath('com.android.tools.build:gradle:7.3.1')
    classpath('org.jetbrains.kotlin:kotlin-gradle-plugin:1.8.0')
  }
}

// --- Kotlin compiler flags for all Android subprojects ---
// Some libraries (e.g. VisionCamera) reference React Native framework-only APIs annotated with
// `@FrameworkAPI`. Opt-in so Kotlin doesn't fail compilation.
subprojects { subproject ->
  subproject.tasks.withType(KotlinCompile).configureEach {
    kotlinOptions {
      freeCompilerArgs += [
          // `-Xopt-in` is deprecated; use `-opt-in`.
          "-opt-in=com.facebook.react.common.annotations.FrameworkAPI",
      ]
    }
  }

  // Ensure androidx.activity APIs used by react-native-image-picker are available on its compile classpath.
  subproject.afterEvaluate {
    if (subproject.plugins.hasPlugin("com.android.library") || subproject.plugins.hasPlugin("com.android.application")) {
      subproject.dependencies {
        add("implementation", "androidx.activity:activity:1.7.2")
      }
    }
  }
}
